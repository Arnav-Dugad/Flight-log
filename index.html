<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Arnav - My Flight Log - Interactive Globe</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet"> <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://unpkg.com/globe.gl@2.30.0/dist/globe.gl.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Outfit', sans-serif;
            background-color: #000;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
        }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(20, 20, 20, 0.65);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-panel {
            background: rgba(10, 10, 14, 0.9); /* Slightly darker for better contrast on mobile */
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* Form Elements */
        select, 
        input[type="date"], 
        input[type="time"],
        input[type="text"], 
        input[type="number"], 
        input[type="range"], 
        input[type="search"],
        input:not([type]) { 
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 8px;
            border-radius: 6px;
            width: 100%;
            outline: none;
            font-family: inherit;
        }
        select:focus, input:focus {
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.1);
        }
        select option {
            background: #1a1a1a;
            color: white;
        }
        
        /* Remove arrows from number input */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }

        /* Mobile specific fixes */
        @media (max-width: 768px) {
            /* Prevent iOS zoom on inputs */
            input, select, textarea {
                font-size: 16px !important;
            }
            .glass-panel {
                border-right: none;
                border-bottom: none; /* Removed bottom border for full drawer feel */
            }
            /* Safe Area Support */
            .safe-pt {
                padding-top: env(safe-area-inset-top, 20px);
            }
            .safe-pb {
                padding-bottom: env(safe-area-inset-bottom, 20px);
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        /* Custom flight card hover */
        .flight-card {
            transition: all 0.2s ease;
        }
        .flight-card:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }
        .flight-card.active-card {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        #globeViz {
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; 
            transition: opacity 1s ease;
        }

        /* Screensaver Mode */
        body.screensaver #ui-layer {
            opacity: 0;
            pointer-events: none;
        }
        body.screensaver #globeViz {
            cursor: none;
        }

        .interactive {
            pointer-events: auto;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .delete-btn {
            opacity: 0;
            transition: opacity 0.2s;
        }
        .flight-card:hover .delete-btn {
            opacity: 1;
        }
        /* Always show delete on mobile for easier access */
        @media (max-width: 768px) {
            .delete-btn { opacity: 1; }
        }

        /* Sidebar Transition */
        #sidebar {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #sidebar.collapsed {
            transform: translateX(-100%);
        }

        /* Modal Transitions */
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s;
        }
        .modal.hidden-modal {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* Airline Dropdown Styles */
        .airline-option {
            transition: background 0.2s;
        }
        .airline-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Passport Styles */
        .passport-card {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Courier Prime', monospace;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        /* Fixed Stamp Styles */
        .stamp {
            font-family: 'Permanent Marker', cursive;
            border: 3px double currentColor;
            opacity: 0.9;
            text-shadow: 0 0 2px rgba(0,0,0,0.5);
        }
        
        /* Barrel Roll Animation */
        @keyframes barrelRoll {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .barrel-rolling {
            animation: barrelRoll 1s ease-in-out;
        }
    </style>
</head>
<body class="text-white">

    <div id="globeViz"></div>

    <div id="ui-layer" class="flex flex-col md:flex-row">
        
        <div class="absolute top-4 left-4 md:top-6 md:left-6 interactive z-50 safe-pt">
             <button onclick="toggleSidebar()" id="expand-btn" class="hidden p-3 rounded-full glass hover:bg-white/10 text-white transition-colors shadow-xl active:scale-95 cursor-pointer">
                <i class="ph-bold ph-list text-lg"></i>
            </button>
        </div>

        <div class="interactive glass-panel fixed md:relative top-0 left-0 h-full w-[85vw] md:w-96 flex flex-col shadow-2xl z-40 transition-transform duration-300 transform md:translate-x-0" id="sidebar">
            <div class="p-3 md:p-4 border-b border-white/10 flex justify-between items-center bg-black/20 safe-pt">
                <div>
                    <h1 class="text-lg md:text-xl font-semibold tracking-tight text-blue-100 flex items-center gap-2">
                        <i id="plane-icon" class="ph-fill ph-airplane-tilt text-blue-500 cursor-pointer hover:text-blue-400 hover:rotate-45 transition-all duration-300" onclick="triggerBarrelRoll()" title="Do a barrel roll!"></i>
                        Travel Log
                    </h1>
                </div>
                <div class="flex items-center gap-1">
                    <button onclick="toggleStats()" class="p-2 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white cursor-pointer" title="Advanced Statistics">
                        <i class="ph-bold ph-chart-bar text-lg"></i>
                    </button>
                    <button onclick="openPassport()" class="p-2 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white cursor-pointer" title="Aviation Passport">
                        <i class="ph-bold ph-identification-card text-lg"></i>
                    </button>
                    <button onclick="toggleSettings()" class="p-2 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white cursor-pointer" title="Settings">
                        <i class="ph-bold ph-gear text-lg"></i>
                    </button>
                    <button onclick="toggleSidebar()" class="p-2 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white cursor-pointer" title="Collapse Sidebar">
                        <i class="ph-bold ph-caret-double-left text-lg"></i>
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-2 p-2 md:p-3 border-b border-white/10 bg-white/5 shrink-0">
                <div class="text-center">
                    <div class="text-[10px] text-gray-400 uppercase tracking-wider">Flights</div>
                    <div class="text-base md:text-lg font-bold text-white" id="total-flights">0</div>
                </div>
                <div class="text-center border-l border-white/10 cursor-pointer hover:bg-white/5 transition-colors rounded" onclick="triggerMoonEasterEgg()" title="Click 5 times for a surprise!">
                    <div class="text-[10px] text-gray-400 uppercase tracking-wider">Distance</div>
                    <div class="text-base md:text-lg font-bold text-blue-400"><span id="total-km">0</span>k</div>
                </div>
                <div class="text-center border-l border-white/10">
                    <div class="text-[10px] text-gray-400 uppercase tracking-wider">Countries</div>
                    <div class="text-base md:text-lg font-bold text-emerald-400" id="total-countries">0</div>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto min-h-0 flex flex-col">
                <div class="p-2 md:p-3 border-b border-white/10 bg-black/10 shrink-0">
                    <div class="space-y-2"> <div class="flex items-end gap-2">
                            <div class="flex-1 min-w-0">
                                <label class="text-[10px] text-gray-500 block mb-1">From</label>
                                <input list="airport-list" type="text" id="input-from" class="text-sm w-full uppercase py-1.5" placeholder="Origin">
                            </div>
                            <button onclick="swapAirports()" class="p-2 mb-1 rounded hover:bg-white/10 text-gray-400 hover:text-blue-400 transition-colors cursor-pointer" title="Swap">
                                <i class="ph-bold ph-arrows-left-right text-lg"></i>
                            </button>
                            <div class="flex-1 min-w-0">
                                <label class="text-[10px] text-gray-500 block mb-1">To</label>
                                <input list="airport-list" type="text" id="input-to" class="text-sm w-full uppercase py-1.5" placeholder="Dest">
                            </div>
                        </div>
                        
                        <datalist id="airport-list">
                            </datalist>

                        <div class="flex gap-2">
                             <div class="w-1/2">
                                <label class="text-[10px] text-gray-500 block mb-1">Date</label>
                                <input type="date" id="input-date" class="text-sm py-1.5">
                             </div>
                             <div class="w-1/2">
                                <label class="text-[10px] text-gray-500 block mb-1">Time</label>
                                <input type="time" id="input-time" class="text-sm py-1.5">
                             </div>
                        </div>
                        
                        <div class="flex gap-2">
                            <div class="w-1/2">
                               <label class="text-[10px] text-gray-500 block mb-1">Flight #</label>
                               <input type="text" id="input-flight-num" class="text-sm py-1.5" placeholder="e.g. EK501">
                            </div>
                            <div class="w-1/2">
                               <label class="text-[10px] text-gray-500 block mb-1">Cost (INR)</label>
                               <input type="number" id="input-cost" class="text-sm py-1.5" placeholder="₹">
                            </div>
                        </div>
                        
                        <div class="relative">
                            <label class="text-[10px] text-gray-500 block mb-1">Airline</label>
                            <button onclick="toggleAirlineDropdown()" id="airline-btn" class="w-full text-left bg-white/5 border border-white/10 rounded-md py-1.5 px-3 text-sm flex items-center justify-between hover:bg-white/10 transition-colors cursor-pointer">
                                <span id="airline-btn-text" class="text-gray-400">Select Airline</span>
                                <i class="ph-bold ph-caret-down text-gray-500"></i>
                            </button>
                            
                            <div id="airline-dropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-[#1a1a1a] border border-white/10 rounded-md shadow-xl z-50 max-h-48 overflow-y-auto">
                                </div>
                            
                            <input type="hidden" id="input-airline">
                        </div>

                        <button onclick="addCustomFlight()" class="w-full py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md text-sm font-medium transition-colors shadow-lg shadow-blue-900/20 mt-1 active:scale-[0.98] cursor-pointer">
                            Add Flight
                        </button>
                    </div>
                </div>

                <div class="px-3 md:px-4 py-2 border-b border-white/10 bg-black/10 flex gap-2 items-center shrink-0">
                    <select id="year-filter" onchange="filterFlights()" class="text-xs bg-white/5 border-none w-auto max-w-[120px] py-1.5 cursor-pointer">
                        <option value="all">All Years</option>
                        </select>
                    <div class="flex-1"></div>
                    <div class="text-[10px] md:text-xs text-gray-500 flex items-center" id="filtered-count"></div>
                </div>

                <div class="flex-1 overflow-y-auto p-2 md:p-4 space-y-1.5 md:space-y-2 pb-20 md:pb-4 safe-pb" id="flight-list">
                    </div>
                
                <div class="p-2 border-t border-white/10 text-center bg-black/20 shrink-0 safe-pb">
                    <button onclick="clearAllFlights()" class="text-xs text-red-400 hover:text-red-300 transition-colors p-2 w-full cursor-pointer">
                        Clear All History
                    </button>
                </div>
            </div>
        </div>

        <div class="flex-1 relative pointer-events-none">
            
            <div id="settings-modal" class="modal hidden-modal absolute inset-0 flex items-center justify-center z-[60] pointer-events-auto bg-black/60 backdrop-blur-sm p-4">
                <div class="glass p-6 rounded-2xl w-full max-w-sm shadow-2xl transform transition-transform scale-100 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <i class="ph-fill ph-gear"></i> Settings
                        </h2>
                        <button onclick="toggleSettings()" class="text-gray-400 hover:text-white p-2 cursor-pointer">
                            <i class="ph-bold ph-x text-lg"></i>
                        </button>
                    </div>

                    <div class="space-y-5">
                        <div>
                            <label class="text-xs text-gray-400 uppercase tracking-wider block mb-2">Map Theme</label>
                            <div class="flex gap-2 p-1 bg-white/5 rounded-lg">
                                <button onclick="setMapStyle('dark')" class="flex-1 py-2 text-xs rounded-md bg-blue-600 text-white transition-all cursor-pointer" id="btn-theme-dark">Dark</button>
                                <button onclick="setMapStyle('light')" class="flex-1 py-2 text-xs rounded-md hover:bg-white/10 text-gray-400 transition-all cursor-pointer" id="btn-theme-light">Light</button>
                            </div>
                        </div>

                        <div>
                            <label class="text-xs text-gray-400 uppercase tracking-wider block mb-2">Options</label>
                            <div class="space-y-2">
                                <label class="flex items-center justify-between p-3 rounded bg-white/5 hover:bg-white/10 cursor-pointer">
                                    <span class="text-sm">Show Airports</span>
                                    <input type="checkbox" checked onchange="toggleAirports(this)" class="accent-blue-500 w-4 h-4 cursor-pointer">
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="text-xs text-gray-400 uppercase tracking-wider block mb-2">Controls</label>
                            <button onclick="toggleGyro()" id="gyro-btn" class="w-full py-2 px-3 bg-white/5 hover:bg-white/10 rounded flex items-center justify-between text-sm transition-colors border border-white/5 cursor-pointer">
                                <span class="flex items-center gap-2"><i class="ph-bold ph-device-rotate"></i> Enable Motion</span>
                                <span class="text-[10px] text-gray-500 uppercase" id="gyro-status">OFF</span>
                            </button>
                        </div>

                        <div>
                            <label class="text-xs text-gray-400 uppercase tracking-wider block mb-2">Auto-Rotation Speed</label>
                            <input type="range" min="0" max="20" value="6" class="w-full accent-blue-500 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer" oninput="updateRotationSpeed(this.value)">
                        </div>

                        <div class="pt-4 border-t border-white/10">
                            <label class="text-xs text-gray-400 uppercase tracking-wider block mb-2">Data Management</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="exportData()" class="py-3 px-3 bg-white/5 hover:bg-white/10 rounded flex items-center justify-center gap-2 text-xs transition-colors cursor-pointer">
                                    <i class="ph-bold ph-download-simple"></i> Export
                                </button>
                                <label class="py-3 px-3 bg-white/5 hover:bg-white/10 rounded flex items-center justify-center gap-2 text-xs transition-colors cursor-pointer">
                                    <i class="ph-bold ph-upload-simple"></i> Import
                                    <input type="file" id="import-file" class="hidden" accept=".json" onchange="importData(this)">
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="passport-modal" class="modal hidden-modal absolute inset-0 flex items-center justify-center z-[60] pointer-events-auto bg-black/80 backdrop-blur-md p-4">
                <div class="flex flex-col items-center gap-4 w-full max-w-[360px]">
                    <div id="passport-capture-area" class="passport-card w-full rounded-2xl overflow-hidden relative flex flex-col text-white p-6 shadow-2xl scale-95 md:scale-100 transform origin-center">
                        <div class="flex justify-between items-start mb-6 z-10">
                            <div class="flex items-center gap-2">
                                <i class="ph-fill ph-globe-hemisphere-west text-3xl text-blue-400"></i>
                                <div>
                                    <div class="text-[10px] uppercase tracking-[0.2em] text-blue-200">Official Document</div>
                                    <div class="text-lg font-bold">AVIATION PASSPORT</div>
                                </div>
                            </div>
                            <div class="w-12 h-12 border border-white/20 rounded bg-white/5 flex items-center justify-center">
                                <i class="ph-fill ph-airplane-tilt text-2xl text-white/50"></i>
                            </div>
                        </div>

                        <div class="flex-1 z-10 space-y-4 mb-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <div class="text-[9px] text-gray-400 uppercase mb-1 flex items-center gap-1"><i class="ph-bold ph-path"></i> Total Distance</div>
                                    <div class="text-xl font-bold text-blue-300" id="pass-dist">--</div>
                                </div>
                                <div>
                                    <div class="text-[9px] text-gray-400 uppercase mb-1 flex items-center gap-1"><i class="ph-bold ph-airplane-takeoff"></i> Flights</div>
                                    <div class="text-xl font-bold text-white" id="pass-flights">--</div>
                                </div>
                            </div>
                            <div>
                                <div class="text-[9px] text-gray-400 uppercase mb-1 flex items-center gap-1"><i class="ph-bold ph-star"></i> Favorite Airline</div>
                                <div class="flex items-center gap-2 mt-1">
                                    <img id="pass-airline-logo" class="w-6 h-6 object-contain hidden">
                                    <div class="text-lg font-bold text-yellow-400" id="pass-airline">--</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <div class="text-[9px] text-gray-400 uppercase mb-1 flex items-center gap-1"><i class="ph-bold ph-flag-banner"></i> Countries</div>
                                    <div class="text-lg font-bold text-emerald-400" id="pass-countries">--</div>
                                </div>
                                <div>
                                    <div class="text-[9px] text-gray-400 uppercase mb-1 flex items-center gap-1"><i class="ph-bold ph-wallet"></i> Total Value</div>
                                    <div class="text-sm font-bold text-white tracking-wide" id="pass-total-cost">--</div>
                                </div>
                            </div>
                        </div>

                        <div class="pt-4 border-t border-white/10 z-10">
                            <div class="text-[9px] text-gray-400 uppercase mb-2">Entry Stamps</div>
                            <div class="grid grid-cols-4 gap-2" id="pass-stamps">
                                </div>
                        </div>

                        <div class="mt-6 pt-2 border-t border-white/10 flex justify-between items-end z-10">
                            <div class="font-mono text-[9px] text-gray-500">
                                ID: <span id="pass-id">FL-8392-X</span>
                            </div>
                            <img id="passport-qr-img" alt="Passport QR" title="Click to expand" onclick="openQrViewer()" class="w-28 h-28 bg-white rounded shadow-md shadow-black/30 transition-opacity duration-300 cursor-pointer" />
                        </div>
                    </div>

                    <div class="flex gap-3 w-full justify-center">
                        <button onclick="downloadPassport()" class="px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-full font-medium shadow-lg transition-colors flex items-center gap-2 text-sm cursor-pointer">
                            <i class="ph-bold ph-download-simple"></i> Save
                        </button>
                        <button onclick="closePassport()" class="px-4 py-3 bg-white/10 hover:bg-white/20 rounded-full transition-colors text-sm cursor-pointer">
                            Close
                        </button>
                    </div>
                </div>
            </div>

            <div id="qr-viewer-modal" class="modal hidden-modal absolute inset-0 flex items-center justify-center z-[65] pointer-events-auto bg-black/80 backdrop-blur-md p-4">
                <div class="glass p-5 rounded-2xl w-full max-w-sm shadow-2xl">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-sm font-semibold flex items-center gap-2">
                            <i class="ph-fill ph-qr-code"></i> Passport QR
                        </div>
                        <button onclick="closeQrViewer()" class="text-gray-400 hover:text-white p-2 cursor-pointer">
                            <i class="ph-bold ph-x text-lg"></i>
                        </button>
                    </div>

                    <div class="flex flex-col items-center gap-3">
                        <img id="qr-viewer-img" alt="Expanded QR" class="w-full max-w-[250px] aspect-square bg-white rounded-lg shadow-md" />
                        <div class="w-full">
                            <div class="text-[10px] text-gray-400 uppercase tracking-wider mb-1">Encoded payload</div>
                            <pre id="qr-viewer-text" class="text-[10px] leading-snug whitespace-pre-wrap break-words bg-black/30 border border-white/10 rounded-lg p-3 max-h-28 overflow-auto"></pre>
                            <div class="flex gap-2 mt-2">
                                <button onclick="copyQrPayload()" class="flex-1 py-3 px-3 bg-white/10 hover:bg-white/20 rounded-lg text-xs transition-colors flex items-center justify-center gap-2 cursor-pointer">
                                    <i class="ph-bold ph-copy"></i> Copy
                                </button>
                                <button onclick="downloadQrPng()" class="flex-1 py-3 px-3 bg-blue-600 hover:bg-blue-500 rounded-lg text-xs transition-colors flex items-center justify-center gap-2 cursor-pointer">
                                    <i class="ph-bold ph-download-simple"></i> Save
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div id="stats-modal" class="modal hidden-modal absolute inset-0 flex items-center justify-center z-[60] pointer-events-auto bg-black/60 backdrop-blur-sm p-4">
                <div class="glass p-5 md:p-6 rounded-2xl w-full max-w-2xl shadow-2xl transform transition-transform scale-100 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <i class="ph-fill ph-chart-bar"></i> Global Statistics
                        </h2>
                        <button onclick="toggleStats()" class="text-gray-400 hover:text-white p-2 cursor-pointer">
                            <i class="ph-bold ph-x text-lg"></i>
                        </button>
                    </div>

                    <div class="space-y-6">
                         <div class="grid grid-cols-3 gap-2 md:gap-3">
                             <div class="p-3 bg-white/5 rounded-lg flex flex-col justify-center text-center md:text-left">
                                 <div class="text-[9px] md:text-[10px] text-gray-400 uppercase truncate flex flex-col md:flex-row items-center gap-1 justify-center md:justify-start">
                                    <i class="ph-fill ph-tree text-emerald-400"></i> <span>Carbon</span>
                                </div>
                                 <div class="text-xs md:text-sm font-bold text-red-400 mt-1 truncate" id="stat-co2">--</div>
                                 <div class="text-[8px] md:text-[9px] text-emerald-400 mt-0.5" id="stat-trees">-- trees</div>
                             </div>
                             <div class="p-3 bg-white/5 rounded-lg flex flex-col justify-center text-center md:text-left">
                                 <div class="text-[9px] md:text-[10px] text-gray-400 uppercase truncate flex flex-col md:flex-row items-center gap-1 justify-center md:justify-start">
                                    <i class="ph-bold ph-currency-inr text-yellow-400"></i> <span>Spent</span>
                                </div>
                                 <div class="text-xs md:text-sm font-bold text-white mt-1 truncate" id="stat-total-spent">₹0</div>
                                 <div class="text-[8px] md:text-[9px] text-gray-400 mt-0.5" id="stat-cost-km">₹0 / km</div>
                             </div>
                             <div class="p-3 bg-white/5 rounded-lg flex flex-col justify-center text-center md:text-left">
                                 <div class="text-[9px] md:text-[10px] text-gray-400 uppercase truncate flex flex-col md:flex-row items-center gap-1 justify-center md:justify-start">
                                    <i class="ph-bold ph-smiley"></i> <span>Vibe</span>
                                </div>
                                 <div class="text-xs md:text-sm font-bold text-blue-300 mt-1 truncate" id="stat-personality">--</div>
                             </div>
                         </div>

                         <div class="grid grid-cols-2 gap-3">
                             <div class="p-3 bg-white/5 rounded-lg flex flex-col justify-center">
                                 <div class="text-[10px] text-gray-400 uppercase truncate flex items-center gap-1"><i class="ph-bold ph-warning"></i> Brutal Hop</div>
                                 <div class="text-sm font-bold text-orange-400 mt-1 truncate" id="stat-brutal-hop">--</div>
                                 <div class="text-[9px] text-gray-500 truncate" id="stat-brutal-hop-val"></div>
                             </div>
                             <div class="p-3 bg-white/5 rounded-lg flex flex-col justify-center">
                                 <div class="text-[10px] text-gray-400 uppercase truncate flex items-center gap-1"><i class="ph-bold ph-hourglass"></i> Tight Connect</div>
                                 <div class="text-sm font-bold text-purple-300 mt-1 truncate" id="stat-tight-conn">--</div>
                                 <div class="text-[9px] text-gray-500 truncate" id="stat-tight-conn-val"></div>
                             </div>
                         </div>

                         <div class="grid grid-cols-2 gap-3">
                            <div class="p-3 bg-white/5 rounded-lg">
                                <div class="text-[10px] text-gray-400 uppercase flex items-center gap-1"><i class="ph-bold ph-arrows-out-line-horizontal"></i> Longest</div>
                                <div class="text-sm font-bold text-blue-400 mt-1 truncate" id="stat-longest">--</div>
                                <div class="text-[10px] text-gray-500 truncate" id="stat-longest-dist"></div>
                            </div>
                            <div class="p-3 bg-white/5 rounded-lg">
                                <div class="text-[10px] text-gray-400 uppercase flex items-center gap-1"><i class="ph-bold ph-arrows-in-line-horizontal"></i> Shortest</div>
                                <div class="text-sm font-bold text-emerald-400 mt-1 truncate" id="stat-shortest">--</div>
                                <div class="text-[10px] text-gray-500 truncate" id="stat-shortest-dist"></div>
                            </div>
                         </div>

                         <div>
                             <h4 class="text-xs text-gray-400 uppercase tracking-wider mb-2">Achievements</h4>
                             <div class="grid grid-cols-2 gap-2" id="achievements-grid">
                                 </div>
                         </div>

                         <div>
                             <h4 class="text-xs text-gray-400 uppercase tracking-wider mb-2">Regions</h4>
                             <div id="region-bars" class="space-y-2">
                                 </div>
                         </div>

                        <div>
                            <h4 class="text-xs text-gray-400 uppercase tracking-wider mb-2">Top Hubs</h4>
                            <div id="stats-airports" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="absolute top-4 right-4 md:top-6 md:right-6 flex flex-col gap-3 interactive z-50 safe-pt">
                <div class="glass rounded-xl p-1 flex flex-col gap-1">
                    <button onclick="zoomToHome()" class="p-3 rounded-lg hover:bg-white/10 text-gray-300 hover:text-white transition-colors active:bg-white/20 cursor-pointer" title="Home (India)">
                        <i class="ph-bold ph-house-line text-lg"></i>
                    </button>
                    <button onclick="fitToMap()" class="p-3 rounded-lg hover:bg-white/10 text-gray-300 hover:text-white transition-colors active:bg-white/20 cursor-pointer" title="Fit to Map">
                         <i class="ph-bold ph-frame-corners text-lg"></i>
                    </button>
                </div>
            </div>

            <div id="flight-info-tooltip" class="absolute bottom-10 md:bottom-12 left-4 right-4 md:left-1/2 md:right-auto md:transform md:-translate-x-1/2 glass rounded-xl border border-white/10 shadow-2xl shadow-blue-900/20 opacity-0 transition-opacity duration-300 flex flex-col overflow-hidden pointer-events-none z-40 max-w-lg mx-auto safe-pb">
                <div class="bg-white/5 p-3 flex justify-between items-center border-b border-white/5">
                    <div class="flex items-center gap-2">
                        <img id="info-airline-logo" class="w-5 h-5 object-contain hidden rounded-sm" alt="">
                        <span class="text-xs font-bold text-gray-200 tracking-wide" id="info-airline">Airline</span>
                    </div>
                    <div class="flex items-center gap-3 text-[10px] font-mono">
                        <span id="info-date" class="text-gray-400"></span>
                        <span id="info-time" class="text-blue-300 bg-blue-500/10 px-1.5 py-0.5 rounded"></span>
                    </div>
                </div>
                
                <div class="p-4 flex items-center justify-between gap-2 bg-black/40 backdrop-blur-xl">
                    <div class="text-center min-w-[50px]">
                        <div class="text-2xl md:text-3xl font-bold text-white tracking-tight leading-none" id="info-from-code">JFK</div>
                        <div class="text-[9px] text-gray-500 uppercase tracking-widest mt-1 truncate max-w-[80px] mx-auto" id="info-from-city">New York</div>
                    </div>
                    
                    <div class="flex flex-col items-center flex-1 px-2">
                        <div class="text-[9px] text-gray-500 font-mono mb-1" id="info-flight-num"></div>
                        <div class="flex items-center gap-2 w-full">
                            <div class="h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent flex-1"></div>
                            <i class="ph-fill ph-airplane text-blue-400 transform rotate-90 text-sm"></i>
                            <div class="h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent flex-1"></div>
                        </div>
                         <div class="text-[9px] text-blue-300 mt-1 font-mono" id="info-dist">5,400 km</div>
                         <div id="info-cost" class="text-[10px] text-green-400 font-mono mt-1 bg-green-900/20 px-1.5 py-0.5 rounded border border-green-500/20 inline-block hidden"></div>
                    </div>

                    <div class="text-center min-w-[50px]">
                        <div class="text-2xl md:text-3xl font-bold text-white tracking-tight leading-none" id="info-to-code">LHR</div>
                        <div class="text-[9px] text-gray-500 uppercase tracking-widest mt-1 truncate max-w-[80px] mx-auto" id="info-to-city">London</div>
                    </div>
                </div>
            </div>

            <div class="absolute bottom-2 w-full text-center z-0 pointer-events-none safe-pb">
                <span class="text-[9px] md:text-[10px] text-white/20 font-mono tracking-widest uppercase">© 2025 Arnav Dugad</span>
            </div>
        </div>
    </div>

    <script>
        // --- Safe DOM Update Helper ---
        function setText(id, text) {
            const el = document.getElementById(id);
            if (el) el.innerText = text;
        }

        // --- Data: Expanded Airport Database with Continent Mapping ---
        const airports = {
            "JFK": { lat: 40.6413, lng: -73.7781, city: "New York", country: "USA", region: "NA" },
            "LHR": { lat: 51.4700, lng: -0.4543, city: "London", country: "UK", region: "EU" },
            "HND": { lat: 35.5494, lng: 139.7798, city: "Tokyo", country: "Japan", region: "AS" },
            "DXB": { lat: 25.2532, lng: 55.3657, city: "Dubai", country: "UAE", region: "AS" },
            "SIN": { lat: 1.3644, lng: 103.9915, city: "Singapore", country: "Singapore", region: "AS" },
            "SYD": { lat: -33.9399, lng: 151.1753, city: "Sydney", country: "Australia", region: "OC" },
            "CDG": { lat: 49.0097, lng: 2.5479, city: "Paris", country: "France", region: "EU" },
            "SFO": { lat: 37.6213, lng: -122.3790, city: "San Francisco", country: "USA", region: "NA" },
            "GRU": { lat: -23.4356, lng: -46.4731, city: "São Paulo", country: "Brazil", regio